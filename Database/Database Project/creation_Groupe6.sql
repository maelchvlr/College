/*
LAZRAK Ilona - 22001576
CHARREAU Léo - 21913600
CHEVALIER Maël - 22003139
BARRERE Loreena - 22206698
*/
SET SERVEROUTPUT ON
ALTER session SET NLS_DATE_FORMAT='DD-MM-YYYY';
 
CREATE TABLE PERSONNE (
  ID_PERSONNE CHAR(10),
  NOM VARCHAR(20) CONSTRAINT NN_PERSONNE_NOM NOT NULL,
  PRENOM VARCHAR(25) CONSTRAINT NN_PERSONNE_PRENOM NOT NULL,
  ADRESSE VARCHAR(50) CONSTRAINT NN_PERSONNE_ADRESSE NOT NULL,
  TELEPHONE VARCHAR(10) CONSTRAINT NN_PERSONNE_TELEPHONE NOT NULL,
  NAISSANCE DATE,
  CONSTRAINT PK_PERSONNE PRIMARY KEY (ID_PERSONNE)
);
 
CREATE TABLE ETUDIANT (
  ID_ETUDIANT CHAR(10),
  FILIERE VARCHAR(30) CONSTRAINT NN_ETUDIANT_FILIERE NOT NULL,
  MOYENNE_LICENCE NUMERIC(4,2) CONSTRAINT CK_ETUDIANT_MOYENNE CHECK (MOYENNE_LICENCE BETWEEN 0 AND 20),
  NBR_CANDIDATURE NUMERIC(3,0),
  CONSTRAINT PK_ETUDIANT PRIMARY KEY (ID_ETUDIANT),
  CONSTRAINT FK_ETUDIANT_NUM_PERSONNE FOREIGN KEY (ID_ETUDIANT)
      REFERENCES PERSONNE(ID_PERSONNE)
      ON DELETE CASCADE
);
 
 
CREATE TABLE ENSEIGNANT (
  NUMEN CHAR(10),
  SPECIALITE VARCHAR(30) CONSTRAINT NN_ENSEIGNANT_SPECIALITE NOT NULL,
  CONSTRAINT PK_ENSEIGNANT PRIMARY KEY (NUMEN),
  CONSTRAINT FK_ENSEIGNANT FOREIGN KEY (NUMEN)
      REFERENCES PERSONNE(ID_PERSONNE)
      ON DELETE CASCADE
);
 
CREATE TABLE UE (
  ID_UE CHAR(10),
  TITRE VARCHAR(150) CONSTRAINT NN_UE_TITRE NOT NULL,
  CONSTRAINT PK_UE PRIMARY KEY (ID_UE)
);
 
CREATE TABLE UNIVERSITE (
  ID_UNI CHAR(10),
  NOM VARCHAR(30) CONSTRAINT NN_UNIVERSITE_NOM NOT NULL,
  VILLE VARCHAR(30) CONSTRAINT NN_UNIVERSITE_VILLE NOT NULL,
  TELEPHONE_UNI VARCHAR(10) CONSTRAINT NN_UNIVERSITE_TEL NOT NULL,
  CONSTRAINT PK_UNIVERSITE PRIMARY KEY (ID_UNI)
);
 
CREATE TABLE MASTERS (
  ID_MASTER CHAR(10),
  DOMAINE_ETUDE VARCHAR(30) CONSTRAINT NN_MASTER_DOMAINE NOT NULL,
  PARCOURS VARCHAR(100) CONSTRAINT NN_MASTER_PARCOURS NOT NULL,
  NUM_UNI CHAR(10),
  CONSTRAINT PK_MASTER PRIMARY KEY (ID_MASTER),
  CONSTRAINT FK_MASTER_NUM_UNI FOREIGN KEY (NUM_UNI)
      REFERENCES UNIVERSITE(ID_UNI)
      ON DELETE CASCADE
);
 
CREATE TABLE CANDIDATURE (
  NUM_ETUDIANT CHAR(10),
  NUM_MASTER CHAR(10),
  DATE_CANDIDATURE DATE CONSTRAINT NN_CANDIDATURE_DATE NOT NULL,
  ETAT VARCHAR(11) CONSTRAINT CK_CANDIDATURE_ETAT CHECK (ETAT IN ('ACCEPTE', 'REFUSE' , 'TRAITEMENT' )),
  CONSTRAINT PK_CANDIDATURE PRIMARY KEY (NUM_ETUDIANT, NUM_MASTER, DATE_CANDIDATURE),
  CONSTRAINT FK_CANDIDATURE_NUM_ETUDIANT FOREIGN KEY (NUM_ETUDIANT)
      REFERENCES ETUDIANT(ID_ETUDIANT)
      ON DELETE CASCADE,
  CONSTRAINT FK_CANDIDATURE_NUM_MASTER FOREIGN KEY (NUM_MASTER)
      REFERENCES MASTERS(ID_MASTER)
      ON DELETE CASCADE
);
 
CREATE TABLE RESPONSABLE (
  NUM_ENSEIGNANT CHAR(10),
  NUM_MASTER CHAR(10),
  ANNEE NUMERIC(4) CONSTRAINT NN_RESPONSABLE_DATE NOT NULL,
  CONSTRAINT PK_RESPONSABLE PRIMARY KEY (NUM_ENSEIGNANT, NUM_MASTER, ANNEE),
  CONSTRAINT FK_RESPONSABLE_NUMEN FOREIGN KEY (NUM_ENSEIGNANT)
      REFERENCES ENSEIGNANT(NUMEN)
      ON DELETE CASCADE,
  CONSTRAINT FK_RESPONSABLE_NUM_MASTER FOREIGN KEY (NUM_MASTER)
      REFERENCES MASTERS(ID_MASTER)
      ON DELETE CASCADE
);
 
CREATE TABLE ENSEIGNEMENT (
  NUM_MASTER CHAR(10),
  NUM_UE CHAR(10),
  VOLUME_HORAIRE NUMERIC(3,0) CONSTRAINT NN_VOLUME_HORAIRE NOT NULL,
  CREDITS NUMERIC(2,0) CONSTRAINT CK_ENSEIGNEMENT_CREDITS CHECK (CREDITS BETWEEN 0 AND 30),
  CONSTRAINT PK_ENSEIGNEMENT PRIMARY KEY (NUM_MASTER, NUM_UE),
  CONSTRAINT FK_ENSEIGNEMENT_NUM_MASTER FOREIGN KEY (NUM_MASTER)
      REFERENCES MASTERS(ID_MASTER)
      ON DELETE CASCADE,
  CONSTRAINT FK_ENSEIGNEMENT_NUM_UE FOREIGN KEY (NUM_UE)
      REFERENCES UE(ID_UE)
      ON DELETE CASCADE
);
/*
    Trigger : l'âge d’une personne. Avant chaque modification de la table, on regarde si la personne est bien née, et si elle a moins de 100 ans.
*/
CREATE OR REPLACE TRIGGER check_age_personne
   BEFORE INSERT OR UPDATE ON PERSONNE
   FOR EACH ROW
DECLARE
   ERREUR_AGE_MAX EXCEPTION;
   ERREUR_AGE_MIN EXCEPTION;
 
BEGIN
 
   IF add_months(:new.NAISSANCE, 0) > add_months(SYSDATE, 0)
       THEN RAISE ERREUR_AGE_MIN;
 
   ELSIF add_months(:new.NAISSANCE, 0) < add_months(SYSDATE, -12*100)
       THEN RAISE ERREUR_AGE_MAX;
   END IF;
 
   EXCEPTION
       WHEN ERREUR_AGE_MAX THEN RAISE_APPLICATION_ERROR(-20254,'L age est trop grand');
       WHEN ERREUR_AGE_MIN THEN RAISE_APPLICATION_ERROR(-20255,'L age est trop petit');
 
END;
/
/*
    Trigger : remplit l’attribut “NBR_CANDIDATURE” de la table ETUDIANT après insert ou update sur CANDIDATURE
*/
CREATE OR REPLACE TRIGGER maj_nbr_candidature
   AFTER UPDATE OR INSERT ON CANDIDATURE
   DECLARE
       etu ETUDIANT%rowtype;
       nb_cand ETUDIANT.NBR_CANDIDATURE%TYPE;
   BEGIN
       FOR etu IN (SELECT ID_ETUDIANT FROM ETUDIANT)
       LOOP
           SELECT count(*) into nb_cand FROM CANDIDATURE WHERE NUM_ETUDIANT=etu.ID_ETUDIANT;
           UPDATE ETUDIANT
               SET NBR_CANDIDATURE=nb_cand
               WHERE ID_ETUDIANT=etu.ID_ETUDIANT;
       end loop;
   END;
/
/*
    Trigger : Si la candidature est dépassée d’un mois, la personne est automatiquement accepté.
*/
CREATE OR REPLACE TRIGGER CHECK_CANDIDATURE_PERIME
    FOR INSERT
    ON CANDIDATURE
    COMPOUND TRIGGER
   
    AFTER STATEMENT IS
    BEGIN
        UPDATE CANDIDATURE
        SET ETAT = 'ACCEPTE'
        WHERE DATE_CANDIDATURE < SYSDATE - INTERVAL '1' MONTH AND ETAT = 'TRAITEMENT';
    END AFTER STATEMENT;
END;
/
/*
    Fonction : prends en paramètre l'ID d'un master et renvoie le nombre de candidature reçues
*/
CREATE OR REPLACE FUNCTION nbr_total_cand_par_master( ID_MASTER IN MASTERS.ID_MASTER%TYPE )
RETURN NUMBER is total NUMBER:=0;
   BEGIN
       SELECT count(*) into total FROM CANDIDATURE WHERE NUM_MASTER=ID_MASTER;
       RETURN total;
   end;
/
/*
    Fonction : prends en paramètre l'ID d'un master et renvoie le nombre de candidats que le master a accepté
*/
CREATE OR REPLACE FUNCTION nbr_cand_accepte_par_master( ID_MASTER IN MASTERS.ID_MASTER%TYPE )
RETURN NUMBER is total NUMBER:=0;
   BEGIN
       SELECT count(*) into total FROM CANDIDATURE WHERE NUM_MASTER=ID_MASTER AND ETAT='ACCEPTE';
       RETURN total;
   end;
/
/*
    Fonction : prends en paramètre deux nombres a et b - avec a<=b, et renvoie le pourcentage de a par rapport à b
*/
CREATE OR REPLACE FUNCTION pourcentage(a IN NUMBER, b IN NUMBER)
RETURN NUMBER is pourcentage NUMBER;
   BEGIN
       pourcentage:=round((a/b)*100);
       RETURN pourcentage;
   end;
/
/*
    Procédure :  on donne le nom d’un université, ca nous renvoie des statistiques. 
*/
CREATE OR REPLACE PROCEDURE statistique_uni (nom_uni IN UNIVERSITE.NOM%TYPE) IS
   id_univ UNIVERSITE.ID_UNI%TYPE;
   master MASTERS%rowtype;
   nbr_cand_total NUMBER;
   nbr_cand_accepte NUMBER;
   total_cand NUMBER:=0;
   total_cand_accepte NUMBER:=0;
BEGIN
   select ID_UNI into id_univ FROM UNIVERSITE WHERE NOM=nom_uni;
   dbms_output.put_line('Pour '  || nom_uni );
   FOR master IN (SELECT * FROM MASTERS WHERE NUM_UNI=id_univ)
       LOOP
           nbr_cand_total:=nbr_total_cand_par_master(master.ID_MASTER);
           total_cand:=total_cand+nbr_cand_total;
           nbr_cand_accepte:=nbr_cand_accepte_par_master(master.ID_MASTER);
           total_cand_accepte:=total_cand_accepte+nbr_cand_accepte;
           dbms_output.put_line('Le master de/d '  || master.DOMAINE_ETUDE || ' : ' || master.PARCOURS || ' a recu '
                                    || nbr_cand_total || ' candidature/s. Il en a accepte ' || nbr_cand_accepte ||
                                    ' soit ' || pourcentage(nbr_cand_accepte,nbr_cand_total) || '%');
       end loop;
 
   dbms_output.put_line('De maniere generale, cette universite a donc recu '  || total_cand ||
                        ' candidatures, en a accepte ' || total_cand_accepte || ' soit ' || pourcentage(total_cand_accepte,total_cand) || '%');
END;
/

/** Insertion des valeurs **/
 
 
 
/** Insertion des étudiants, d'abord dans la table PERSONNE **/
 
INSERT INTO PERSONNE VALUES ('0000000001','BARRERE','Loreena','Montpellier','0123456789','12-12-2002');
INSERT INTO PERSONNE VALUES ('0000000002','CHARREAU','Leo','Montpellier','0123556789','04-04-2004');
INSERT INTO PERSONNE VALUES ('0000000003','CHEVALIER','Mael','Montpellier','0123488789','14-11-2002');
INSERT INTO PERSONNE VALUES ('0000000004','LAZRAK','Ilona','Montpellier','0124566789','16-10-2003');
INSERT INTO PERSONNE VALUES ('0000000005','BARRERE','Vanessa','Saint-Brieux','0123128389','21-09-2000');
INSERT INTO PERSONNE VALUES ('0000000006','LOVECRAFT','HP','Paris','0684526789','20-08-2003');
INSERT INTO PERSONNE VALUES ('0000000007','HUGO','Victor','Besançon','0652396789','26-02-1994');
INSERT INTO PERSONNE VALUES ('0000000008','ZUSAK','Marcus','Brest','0785136789','25-06-2000');
INSERT INTO PERSONNE VALUES ('0000000009','HUNTER','Erin','Besançon','0671696789','04-11-1998');
INSERT INTO PERSONNE VALUES ('0000000010','RIORDAN','Rick','Toulon','078686789','25-06-1999');
 
  /** Puis dans la table ETUDIANTS **/
 
INSERT INTO ETUDIANT VALUES ('0000000001','Informatique',15.25, NULL);
INSERT INTO ETUDIANT VALUES ('0000000002','Informatique',14.12, NULL);
INSERT INTO ETUDIANT VALUES ('0000000003','Informatique',11.08, NULL);
INSERT INTO ETUDIANT VALUES ('0000000004','Informatique',12.25, NULL);
INSERT INTO ETUDIANT VALUES ('0000000005','Biologie',18.25, NULL);
INSERT INTO ETUDIANT VALUES ('0000000006','Chimie',13.00, NULL);
INSERT INTO ETUDIANT VALUES ('0000000007','Physique',10.07, NULL);
INSERT INTO ETUDIANT VALUES ('0000000008','Physique',12.56, NULL);
INSERT INTO ETUDIANT VALUES ('0000000009','Biologie',19.17, NULL);
INSERT INTO ETUDIANT VALUES ('0000000010','Biologie',13.75, NULL);
 
/** Insertion des professeurs, d'abord dans la table PERSONNE **/
 
 
INSERT INTO PERSONNE VALUES ('0000000011','NEBUT','Clementine','Mende','0128436789','18-11-1981');
INSERT INTO PERSONNE VALUES ('0000000012','MOURLEVAT','Jean-Claude','Ambert','0508595067','22-03-1952');
INSERT INTO PERSONNE VALUES ('0000000013','GIORGI','Pascal','Montpellier','015636789','28-07-1979');
INSERT INTO PERSONNE VALUES ('0000000014','RETORE','Christian','Avignon','0508595017','14-08-1952');
INSERT INTO PERSONNE VALUES ('0000000015','STIEFVATER','Maggie','Marseilles','0123746789','18-11-1981');
INSERT INTO PERSONNE VALUES ('0000000016','TESLA','Nikola','Strasbourg','050858417','05-01-1968');
INSERT INTO PERSONNE VALUES ('0000000017','TURING','Alan','Lille','0758946789','23-01-1981');
INSERT INTO PERSONNE VALUES ('0000000018','LAVOISIER','Antoine','Paris','0508036017','22-03-1966');
INSERT INTO PERSONNE VALUES ('0000000019','GAUSS','Friedrich ','Marseilles','0145064789','15-12-1984');
INSERT INTO PERSONNE VALUES ('0000000020','LECLERE','Michel','Montpellier','0789435017','14-07-1980');
 
  /** Puis dans la table ENSEIGNANT **/
 
INSERT INTO ENSEIGNANT VALUES ('0000000011','Informatique');
INSERT INTO ENSEIGNANT VALUES ('0000000012','Biologie');
INSERT INTO ENSEIGNANT VALUES ('0000000013','Informatique');
INSERT INTO ENSEIGNANT VALUES ('0000000014','Informatique');
INSERT INTO ENSEIGNANT VALUES ('0000000015','Biologie');
INSERT INTO ENSEIGNANT VALUES ('0000000016','Chimie');
INSERT INTO ENSEIGNANT VALUES ('0000000017','Physique');
INSERT INTO ENSEIGNANT VALUES ('0000000018','Physique');
INSERT INTO ENSEIGNANT VALUES ('0000000019','Chimie');
INSERT INTO ENSEIGNANT VALUES ('0000000020','Informatique');
 
INSERT INTO UNIVERSITE VALUES ('UNI0000001','UM','Montpellier','0123564857');
INSERT INTO UNIVERSITE VALUES ('UNI0000002','Unistra','Strasbourg','0532458566');
INSERT INTO UNIVERSITE VALUES ('UNI0000003','UBO','Brest','0123564857');
INSERT INTO UNIVERSITE VALUES ('UNI0000004','Paris-Sacley','Paris','0169156750');
INSERT INTO UNIVERSITE VALUES ('UNI0000005','UPS','Toulouse','0173006661');
INSERT INTO UNIVERSITE VALUES ('UNI0000006','Universite de Toulon','Toulon','0494142000');
INSERT INTO UNIVERSITE VALUES ('UNI0000007','Sorbonne Universite','Paris','0140462211');
INSERT INTO UNIVERSITE VALUES ('UNI0000008','Universite de Paris','Paris','0144078000');
INSERT INTO UNIVERSITE VALUES ('UNI0000009','Universite Claude Bernard','Lyon','0472448000');
INSERT INTO UNIVERSITE VALUES ('UNI0000010','Universite de Bordeaux','Bordeaux','057571010');
 
 
 
/** Insertion des UEs **/
 
INSERT INTO UE VALUES ('INF01','Fondements IA symbolique');
INSERT INTO UE VALUES ('INF02','Architectures Logicielles Distribuees');
INSERT INTO UE VALUES ('INF03','Entrepots de donnees et BigData');
INSERT INTO UE VALUES ('INF04','Ingenierie Logicielle');
INSERT INTO UE VALUES ('INF05','Logique, Calculabilite, Complexite');
INSERT INTO UE VALUES ('INF06','TER');
INSERT INTO UE VALUES ('INF07','Traitement semantique des donnees');
INSERT INTO UE VALUES ('INF08','Probabilites, statistiques');
INSERT INTO UE VALUES ('INF09','Algorithmes d’exploration et de mouvement');
INSERT INTO UE VALUES ('INF10','Machine learning');
 
INSERT INTO UE VALUES ('GEN01','Anglais');
INSERT INTO UE VALUES ('GEN02','Pre Professionnalisation en informatique');
INSERT INTO UE VALUES ('GEN03','Stage academique');
INSERT INTO UE VALUES ('GEN04','Stage industriel');
INSERT INTO UE VALUES ('GEN05','Projet Tutore');
 
INSERT INTO UE VALUES ('BIO01','Biochimie Structurale');
INSERT INTO UE VALUES ('BIO02','Structure Dynamique et fonction des biomembranes');
INSERT INTO UE VALUES ('BIO03','Metabolisme integre et regulations');
INSERT INTO UE VALUES ('BIO04','Enzymologie');
INSERT INTO UE VALUES ('BIO05','Imagerie cellulaire et resonance magnetique');
INSERT INTO UE VALUES ('BIO06','Synthese des biomolecules');
INSERT INTO UE VALUES ('BIO07','Biocapteurs et biopiles');
INSERT INTO UE VALUES ('BIO08','Cancers et aspects moleculaires');
INSERT INTO UE VALUES ('BIO09','Genetique moleculaire des maladies hereditaires');
 
INSERT INTO UE VALUES ('PHY01','Atomes, Molecules et Rayonnement');
INSERT INTO UE VALUES ('PHY02','Physique de la matiere condensee 1');
INSERT INTO UE VALUES ('PHY03','Modelisation et Simulation en Physique');
INSERT INTO UE VALUES ('PHY04','Physique et technologie des composants');
INSERT INTO UE VALUES ('PHY05','Physique experimentale');
INSERT INTO UE VALUES ('PHY06','Acquisition et traitements des donnees 2');
INSERT INTO UE VALUES ('PHY07','Acquisition et traitements des donnees 1');
INSERT INTO UE VALUES ('PHY08','Physique de la Matiere Condensee 2');
INSERT INTO UE VALUES ('PHY09','Simulation des structures quantiques');
INSERT INTO UE VALUES ('PHY10','Physique des nanostructures');
 
INSERT INTO UE VALUES ('CHM01','Chimie organometallique et chimie des hetero-elements');
INSERT INTO UE VALUES ('CHM02','Chimie de coordination et chimie organique');
INSERT INTO UE VALUES ('CHM03','Chimiometrie, analyse statistique des donnees, plan d’expe');
INSERT INTO UE VALUES ('CHM04','Methodologie de caracterisation des materiaux');
INSERT INTO UE VALUES ('CHM05','Materiaux inorganiques avances');
INSERT INTO UE VALUES ('CHM06','Thermodynamique et equilibres de phases');
INSERT INTO UE VALUES ('CHM07','Materiaux a proprietes electroniques remarquables');
INSERT INTO UE VALUES ('CHM08','Proprietes electroniques et optiques');
INSERT INTO UE VALUES ('CHM09','Chimie de coordination des elements f');
INSERT INTO UE VALUES ('CHM10','Chimie Verte');
 
INSERT INTO UE VALUES ('DRT01','Droit des recessions');
INSERT INTO UE VALUES ('DRT02','Droit des successions');
INSERT INTO UE VALUES ('DRT03','Droit rural');
INSERT INTO UE VALUES ('DRT04','Les contrats d assurance');
INSERT INTO UE VALUES ('DRT05','Credit immobilier');
 
 
INSERT INTO MASTERS VALUES ('MAS0000001', 'Informatique', 'Intelligence Artificielle et Science des Donnees', 'UNI0000001');
INSERT INTO MASTERS VALUES ('MAS0000002', 'Biologie', 'Biologie Sante', 'UNI0000001');
INSERT INTO MASTERS VALUES ('MAS0000003', 'Chimie', 'Chimie moleculaire et supramoleculaire', 'UNI0000002');
INSERT INTO MASTERS VALUES ('MAS0000004', 'Droit', 'Droit du patrimoine et des activites immobilieres', 'UNI0000003');
INSERT INTO MASTERS VALUES ('MAS0000005', 'Physique', 'Physique des plasmas et de la fusion', 'UNI0000004');
INSERT INTO MASTERS VALUES ('MAS0000006', 'Astrophysique', 'Sciences de l univers et technologies spatiales', 'UNI0000005');
INSERT INTO MASTERS VALUES ('MAS0000007', 'Biologie', 'Biologie vegetale', 'UNI0000005');
INSERT INTO MASTERS VALUES ('MAS0000008', 'Informatique', 'Informatique parcours Developpement et Ingenierie des Donnees (DID)', 'UNI0000006');
INSERT INTO MASTERS VALUES ('MAS0000009', 'Physique', 'Physique fondamentale et applications', 'UNI0000007');
INSERT INTO MASTERS VALUES ('MAS0000010', 'Physique', 'Outils et systemes de l astronomie et de l espace', 'UNI0000008');
INSERT INTO MASTERS VALUES ('MAS0000011', 'Informatique', 'Numerique et Sciences Informatiques', 'UNI0000009');
INSERT INTO MASTERS VALUES ('MAS0000012', 'Chimie', 'Toxicologie et eco-toxicologie', 'UNI0000010');
INSERT INTO MASTERS VALUES ('MAS0000013', 'Chimie', 'Biochimie, biologie moleculaire', 'UNI0000010');
 
 
 
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000001','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000002','01-12-2022','REFUSE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000003','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000004','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000005','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000006','01-12-2022','REFUSE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000007','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000008','01-12-2022','REFUSE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000009','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000010','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000011','01-12-2022','REFUSE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000012','01-12-2022','REFUSE');
INSERT INTO CANDIDATURE VALUES ('0000000001','MAS0000013','01-12-2022','ACCEPTE');

INSERT INTO CANDIDATURE VALUES ('0000000002','MAS0000001','05-12-2022','TRAITEMENT');
INSERT INTO CANDIDATURE VALUES ('0000000002','MAS0000008','05-12-2022','TRAITEMENT');
INSERT INTO CANDIDATURE VALUES ('0000000002','MAS0000011','05-12-2022','TRAITEMENT');

INSERT INTO CANDIDATURE VALUES ('0000000006','MAS0000013','05-12-2022','REFUSE');
INSERT INTO CANDIDATURE VALUES ('0000000006','MAS0000012','02-12-2022','REFUSE');
INSERT INTO CANDIDATURE VALUES ('0000000006','MAS0000011','05-12-2022','REFUSE');

INSERT INTO CANDIDATURE VALUES ('0000000009','MAS0000007','01-12-2022','ACCEPTE');
INSERT INTO CANDIDATURE VALUES ('0000000009','MAS0000009','01-12-2022','ACCEPTE');
 
 
 
INSERT INTO RESPONSABLE VALUES ('0000000011','MAS0000001',2001);
INSERT INTO RESPONSABLE VALUES ('0000000012','MAS0000001',2003);
INSERT INTO RESPONSABLE VALUES ('0000000013','MAS0000004',2006);
INSERT INTO RESPONSABLE VALUES ('0000000014','MAS0000011',2001);
INSERT INTO RESPONSABLE VALUES ('0000000015','MAS0000006',2008);
INSERT INTO RESPONSABLE VALUES ('0000000016','MAS0000003',2006);
INSERT INTO RESPONSABLE VALUES ('0000000017','MAS0000007',2010);
INSERT INTO RESPONSABLE VALUES ('0000000018','MAS0000012',2012);
INSERT INTO RESPONSABLE VALUES ('0000000011','MAS0000002',2001);
INSERT INTO RESPONSABLE VALUES ('0000000011','MAS0000005',2004);
INSERT INTO RESPONSABLE VALUES ('0000000013','MAS0000004',2016);
INSERT INTO RESPONSABLE VALUES ('0000000012','MAS0000013',1994);
INSERT INTO RESPONSABLE VALUES ('0000000015','MAS0000008',2010);
INSERT INTO RESPONSABLE VALUES ('0000000016','MAS0000001',2023);
INSERT INTO RESPONSABLE VALUES ('0000000011','MAS0000009',2009);
INSERT INTO RESPONSABLE VALUES ('0000000011','MAS0000010',1997);
 
-- informatique
 
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000001','INF01',20,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000001','INF02',20,5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000001','INF03',20,15);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000001','INF04',20,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000008','INF05',80,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000008','INF06',80,7);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000008','INF07',80,9);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000008','INF08',80,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000011','INF09',110,15);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000011','INF10',110,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000011','INF02',120,3);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000011','INF07',10,4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000008','INF04',80,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000011','INF03',65,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000001','INF06',80,5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000001','GEN01',20,2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000008','GEN01',30,3);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000011','GEN01',20,2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000008','GEN02',20,2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000011','GEN03',25,4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000001','GEN05',10,3);
 
-- droit
 
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000004','GEN01',30,3);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000004','DRT01',40,10);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000004','GEN03',10,4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000004','DRT03',10,5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000004','DRT02',10,15);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000004','DRT04',10,5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000004','DRT05',10,5);
 
 
 
-- BIOLOGIE
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000002', 'BIO01', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000002', 'BIO02', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000007', 'BIO03', 80, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000002', 'BIO04', 80, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000007', 'BIO05', 20, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000007', 'BIO06', 80, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000002', 'BIO07', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000007', 'BIO08', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000002', 'BIO09', 20, 3);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000007', 'BIO09', 60, 5);
 
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000002', 'GEN01', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000002', 'GEN02', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000007', 'GEN03', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000007', 'GEN04', 20, 2);
 
-- PHYSIQUE
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000005', 'PHY01', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000005', 'PHY02', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000009', 'PHY03', 80, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000005', 'PHY04', 80, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000010', 'PHY05', 20, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000010', 'PHY06', 80, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000009', 'PHY07', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000005', 'PHY08', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000005', 'PHY09', 20, 3);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000009', 'PHY10', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000009', 'PHY05', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000009', 'PHY04', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000010', 'PHY02', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000010', 'PHY07', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000010', 'PHY09', 60, 5);
 
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000009', 'GEN03', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000009', 'GEN02', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000005', 'GEN04', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000005', 'GEN03', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000010', 'GEN01', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000010', 'GEN02', 20, 2);
 
-- CHIMIE
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000003', 'CHM01', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000003', 'CHM02', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000012', 'CHM03', 80, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000003', 'CHM04', 80, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000013', 'CHM05', 20, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000013', 'CHM06', 80, 4);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000012', 'CHM07', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000003', 'CHM08', 20, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000003', 'CHM09', 20, 3);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000012', 'CHM10', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000012', 'CHM05', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000012', 'CHM04', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000013', 'CHM02', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000013', 'CHM07', 60, 5);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000013', 'CHM09', 60, 5);
 
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000012', 'GEN03', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000012', 'GEN02', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000003', 'GEN04', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000003', 'GEN03', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000013', 'GEN01', 20, 2);
INSERT INTO ENSEIGNEMENT VALUES ('MAS0000013', 'GEN02', 20, 2);

prompt -- Quels sont les étudiants qui se sont inscrits à tous les masters ?
SELECT ID_PERSONNE, PRENOM, NOM
FROM PERSONNE P
WHERE NOT EXISTS (  
SELECT * FROM MASTERS M WHERE NOT EXISTS (    
	SELECT * FROM CANDIDATURE WHERE P.ID_PERSONNE =
	CANDIDATURE.NUM_ETUDIANT AND M.ID_MASTER =
 	CANDIDATURE.NUM_MASTER));

prompt -- Quels sont les étudiants qui ont candidaté uniquement à tous les masters d’informatique ?
SELECT NUM_ETUDIANT, PRENOM, NOM
FROM CANDIDATURE C
JOIN PERSONNE ON NUM_ETUDIANT = ID_PERSONNE
WHERE NOT EXISTS ( 
SELECT * FROM MASTERS M WHERE DOMAINE_ETUDE = 'Informatique' and NOT EXISTS (   
   SELECT * FROM CANDIDATURE WHERE C.NUM_ETUDIANT = CANDIDATURE.NUM_ETUDIANT
   AND M.ID_MASTER = CANDIDATURE.NUM_MASTER))
Group By NUM_ETUDIANT, PRENOM, NOM
having count(NUM_MASTER) = (select count(*) from Masters where DOMAINE_ETUDE = 'Informatique');

prompt -- Pour chaque étudiant, dans quels master a-t-il été accepté (état = ACCEPTE)? Donné par ordre alphabétique des noms de famille.
SELECT NUM_ETUDIANT, NOM, PRENOM, NUM_MASTER
FROM CANDIDATURE
JOIN PERSONNE ON NUM_ETUDIANT = ID_PERSONNE
WHERE ETAT = 'ACCEPTE'
GROUP BY NUM_ETUDIANT, NOM, PRENOM, NUM_MASTER
ORDER BY NOM ASC;

prompt -- Quelles sont les UE qui intéressent l’étudiant Erin HUNTER ?
SELECT distinct TITRE 
FROM UE 
JOIN ENSEIGNEMENT ON NUM_UE = ID_UE 
JOIN CANDIDATURE ON CANDIDATURE.NUM_MASTER = ENSEIGNEMENT.NUM_MASTER WHERE NUM_ETUDIANT = (SELECT ID_PERSONNE 
FROM PERSONNE 
WHERE NOM = 'HUNTER' AND PRENOM = 'Erin');


prompt -- Quels sont les étudiants qui ont une moyenne supérieure à la moyenne de tous les étudiants ?
SELECT NOM, PRENOM 
FROM ETUDIANT 
JOIN PERSONNE ON ID_ETUDIANT = ID_PERSONNE  
WHERE MOYENNE_LICENCE > (SELECT AVG(MOYENNE_LICENCE) FROM ETUDIANT);